<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- CSP Report-Only: Require SRI for scripts and send reports -->
  <meta http-equiv="Content-Security-Policy-Report-Only"
    content="require-sri-for script; report-uri https://falling-tree-3973.tines.com/webhook/your-first-story/">

  <title>Pixel Whisperer (DEV)</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="./style.css" />
  <link rel="icon" type="image/x-icon" href="../img/favicon.ico" />
  <script src="../hashscript.js" integrity="sha384-QK+xAfM57HSrv9WQCd9U0YaFkfng/k7P4n1I2v7fBfSC3Il4Z19cBP+TDc00NFP+" crossorigin="anonymous"></script>
</head>
<body onload="init()">
  <div class="container-fluid">
    <h1 id="page-heading" class="text-center">Pixel Whisperer (DEV)</h1>

    <div class="row g-3">

      <!-- Left: Image area -->
      <div class="col-12 col-lg-6">
        <div class="border rounded p-2 border-3">
          <p id="pic-caption" class="text-center">
            Mouse over the image below to see hex code and closest colour name.
          </p>

          <!-- Image Box -->
          <div id="img-box" class="position-relative border">
            <div id="image-fence" class="overflow-auto">
              <div id="picture-frame">
                <img id="picker-image" src="../img/Sculpture.jpg" />
                <img id="original-image" src="../img/Sculpture.jpg" style="display:none;" />
              </div>
              <div id="horizontal-line" class="crosshair-line"></div>
              <div id="vertical-line" class="crosshair-line"></div>
            </div>
          </div>

          <div id="anchor-links" class="d-flex justify-content-center gap-2 my-2">
            <a href="#change-image">Upload or take a photo</a>
          </div>
          <!-- Arrow Pad -->
          <div class="my-3 text-center" id="arrowpad">
            <div class="d-inline-grid" style="grid-template-columns: auto auto auto auto auto; gap: 0.25rem;">
              <div></div>
              <div></div>
              <button class="btn btn-outline-secondary btn-sm" id="fast-up">↑↑</button>
              <div></div>
              <div></div>
              <div></div>
              <div></div>
              <button class="btn btn-outline-secondary btn-sm" id="up">↑</button>
              <div></div>
              <div></div>
              <button class="btn btn-outline-secondary btn-sm" id="fast-left">←←</button>
              <button class="btn btn-outline-secondary btn-sm" id="left">←</button>
              <div></div>
              <button class="btn btn-outline-secondary btn-sm" id="right">→</button>
              <button class="btn btn-outline-secondary btn-sm" id="fast-right">→→</button>
              <div></div>
              <div></div>
              <button class="btn btn-outline-secondary btn-sm" id="down">↓</button>
              <div></div>
              <div></div>
              <div></div>
              <div></div>
              <button class="btn btn-outline-secondary btn-sm" id="fast-down">↓↓</button>
              <div></div>
              <div></div>

            </div>
          </div>

<!-- Zoom Controls -->
<fieldset class="mb-3 text-center" id="zoom-box">
  <legend class="form-label mb-1">Zoom</legend>
  <div class="btn-group flex-wrap" role="group" aria-label="Zoom options">
    <button type="button" class="btn btn-outline-secondary btn-sm" id="zoom-in">Zoom In +</button>
    <div id="zoom-level-box">
      <p id="zoom-level" class="mb-0">x1</p>
    </div>
    <button type="button" class="btn btn-outline-secondary btn-sm" id="zoom-out">Zoom Out −</button>
  </div>
</fieldset>



          <!-- Brightness Controls -->
          <div class="mb-3 debug">
            <label class="form-label">Brightness</label>
            <div class="d-flex align-items-center">
              <input type="range" min="1" max="100" value="50" class="form-range me-2 flex-grow-1" id="brightness">
              <button type="button" class="btn btn-outline-secondary btn-sm" id="brightness-reset">Reset</button>
            </div>
          </div>

          <!-- Contrast Controls -->
          <div class="mb-3 debug">
            <label class="form-label">Contrast</label>
            <div class="d-flex align-items-center">
              <input type="range" min="1" max="100" value="50" class="form-range me-2 flex-grow-1" id="contrast">
              <button type="button" class="btn btn-outline-secondary btn-sm" id="contrast-reset">Reset</button>
            </div>
          </div>
        </div>
      </div>

      <!-- Middle: Colour Info -->
      <div class="col-8 col-md-4 col-lg-2 mx-auto">
        <div class="border rounded p-2 border-3">
          <h3 class="text-center">Colour Info</h3>
          <h4>Closest colour name</h4>
          <p id="colour-name">&nbsp;</p>
          <h4>Hex code</h4>
          <p id="colour-hex">&nbsp;</p>
          <h4>RGB values</h4>
          <div class="rgb-bar mb-1">
            <div id="red-amount" class="rgb-amount" style="background-color:red;"></div>
          </div>
          <div class="rgb-bar mb-1">
            <div id="green-amount" class="rgb-amount" style="background-color:green;"></div>
          </div>
          <div class="rgb-bar mb-1">
            <div id="blue-amount" class="rgb-amount" style="background-color:blue;"></div>
          </div>
          <div class="form-check my-3">
            <input type="checkbox" id="average-mode" class="form-check-input">
            <label for="average-mode" class="form-check-label">Average colour (3x3)</label>
          </div>
          <h4>Magnifying glass</h4>
          <div id="mag-glass" class="border"></div>
          <input type="range" min="1" max="15" value="11" class="form-range my-2" id="mag-res">
          <p id="pixel-xy">0 right, 0 down</p>
        </div>
      </div>

      <!-- Right: Selected Pixels -->
      <div class="col-8 col-md-4 col-lg-2 text-center mx-auto">
        <div class="border rounded p-2 border-3 text-center">
          <h3 class="text-center">Selected Pixels</h3>
          <ol id="pixel-list" class="overflow-auto" style="max-height:60vh;"></ol>
          <div class="d-flex gap-2 mt-2 text-center">
            <button id="copy-button" class="btn btn-primary btn-sm">Copy</button>
            <button id="export-button" class="btn btn-secondary btn-sm">Export</button>
            <button id="clear-button" class="btn btn-danger btn-sm">Clear</button>
          </div>
        </div>
      </div>

      <!-- Image Upload -->
      <div class="col-4 col-lg-1 text-center mx-auto">
        <div class="border rounded p-2 border-3">
          <h3 class="text-center" id="change-image">Change Image</h3>
          <div class="popup" id="image-popup-icon">&#9432
            <span class="popuptext" id="image-popup-text">No images leave your device - all processing occurs locally.</span>
          </div>
          <!-- Hidden file input -->
          <input type="file" id="image-upload-button" accept="image/*" class="d-none" />

          <!-- Custom label styled as button -->
          <label for="image-upload-button" class="btn btn-outline-primary btn-sm mb-2">Upload</label>

          <button id="camera-button" class="btn btn-outline-primary btn-sm mb-1">Take Photo</button>
          <button id="camera-close-button" class="btn btn-outline-secondary btn-sm mb-1" style="display: none;">Close Camera</button>
          <video id="camera-preview" class="w-100" autoplay playsinline></video>
        </div>
      </div>


    </div>
  </div>

  <footer class="text-center small py-2">
    <p>
      Copyright <script>document.write(new Date().getFullYear());</script> Rhys Fenwick.
      Created at <a href="https://anu.edu.au">ANU</a>.
      Code at <a href="https://github.com/RhysFenwick/PixelWhisperer">GitHub</a> under
      <a href="https://opensource.org/license/mit">MIT Licence</a>. Code produced with the assistance of generative AI.
      Have feedback or a suggestion? <a href="mailto:rhys.fenwick@anu.edu.au?subject=Pixel%20Whisperer%20Improvement%20Suggestion">Let me know!</a>
      <input type="checkbox" id="elab-mode" class="form-check-input">
      <label for="elab-mode" class="form-check-label">ELab Mode</label>
    </p>
  </footer>

  <script src="./script.js?v=1.4"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
